# UDP

## 前言
前面我们了解了网络协议，网络协议对我们前端工程师来说，是必须要掌握的知识。今天，我们先来看看UDP。

## UDP协议的特点
我对UDP协议的特点的理解无非就是三点:
1. UDP协议是无连接的，也就是说不需要在正式传递数据之前先连接起双方，传输快。
2. UDP协议只是数据报文的搬运工，不保证有序且不丢失的传递到对端。
3. UDP协议没有任何控制流量的算法

接下来，我们来详细了解这三个特点

## 面向无连接
UDP发送数据时不需要和TCP一样在发送数据前进行三次握手建立连接的，想发数据就可以开始发送了。并且UDP不对报文进行任何拆分和拼接操作。具体来说就是:
* 在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后就传递给网络层了
* 在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作

## 不可靠性
至于为什么不可靠，相信大家都清楚。通信都不需要连接，想发就发，这样的情况肯定不可靠。并且收到什么数据就传递什么数据，并且也不会备份数据，发送方也不会关心对方是否已经正确接收到数据。但还有另外一点就是，UDP没有拥塞控制，因我们网络环境时好时坏，UDP一直以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整，这样的弊端就是在网络条件不好的情况下可能会导致丢包。但是优点也很明显，就是在某些实时性要求高的场景(比如联网游戏)就需要使用UDP而不是TCP

## 高效
从上面我们可以知道，UDP不是那么可靠，或者说根本不可靠。但是，正是因为它的不可靠，给他带来了另外一个优点就是，它没TCP那么复杂，也不需要保证数据不丢失且有序的到达。
所以它的头部开销非常小，只有八字节，相比TCP的至少20字节来看是少的多，在传输时是很高效的。

![](http://img.stallezhou.cn/blog/UDP_header.png)

UDP头部包含了以下数据:
* 两个十六位的端口号，分别为源端口（可选字段）和目标端口
* 整个数据报文的长度
* 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误

## 传输方式
UDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。

## 适用场景
虽然UDP有很多缺点，但是正因为这些缺点造就了它高效的特性，在很多实时性要求高的地方都有它的身影

### 网络直播
想必在座的各位应该都看过网络直播，不管是游戏还是其他的。大家会不会经常遇到这种情况，就是画面卡顿局部出现像马赛克的东西，这其实就是使用UDP协议导致的，因为UDP协议不保证不丢包，所以马赛克的地方就是丢包导致的。
### 联网游戏
这里的联网游戏有很多，我就不一一列举，我就举一个我自己玩的，lol。虽然我不知道它底层到底是什么协议，但对于这种实时性很高的游戏来说。不用UDP是不行的，为什么呢？首先，对于这类游戏来说，用户量比较大，同时在线人数多，如果都用TCP的话，需要给每个用户建立一个TCP连接，这很显然会出现服务器不够用的情况，因为每台服务器可提供支撑的TCP连接数量是非常有限的。再者，因为TCP会严格控制传输的正确性，如果用户因为网络不稳定导致页面卡顿，如果网络恢复后再传给我旧的画面，是肯定不能接受的。用户肯定是想要最新的画面，所以我说不用UDP是不行的。

# 总结
UDP虽然简单，但也是我们生活中不可或缺的一部分。努力做好自己本分的工作才是最重要的，所以加油吧，打工人


